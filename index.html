<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>æç®€è‡ªå¾‹</title>
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ffffff">

    <style>
        :root { --bg: #ffffff; --main: #000000; --gray: #f2f2f2; }
        body { background: var(--bg); color: var(--main); font-family: sans-serif; margin: 0; padding: 20px; }
        .card { background: var(--gray); border-radius: 24px; padding: 20px; margin-bottom: 25px; }
        h1 { font-size: 32px; font-weight: 900; margin-bottom: 25px; letter-spacing: -1px; }
        label { display: block; font-size: 12px; margin: 10px 0 5px 10px; font-weight: bold; }
        input { width: 100%; border: none; background: #fff; padding: 15px; border-radius: 15px; margin-bottom: 12px; box-sizing: border-box; font-size: 16px; outline: none; }
        .primary-btn { width: 100%; background: var(--main); color: #fff; border: none; padding: 16px; border-radius: 18px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .goal-item { border: 2px solid var(--main); border-radius: 22px; padding: 18px; margin-bottom: 15px; }
        .goal-header { display: flex; justify-content: space-between; align-items: center; }
        .goal-item.done { background: var(--gray); border-color: var(--gray); opacity: 0.6; }
        .check-box { width: 30px; height: 30px; border: 2px solid var(--main); border-radius: 50%; cursor: pointer; flex-shrink: 0; }
        .done .check-box { background: var(--main); position: relative; }
        .done .check-box::after { content: 'âœ“'; color: #fff; position: absolute; left: 8px; top: 2px; font-size: 18px; }
        .sync-btn { background: #000; color: #fff; font-size: 11px; padding: 6px 12px; border-radius: 12px; border: none; margin-top: 10px; cursor: pointer; }
        .delete-link { font-size: 12px; color: #888; background: none; border: none; text-decoration: underline; margin-top: 15px; cursor: pointer; display: block; }
        
        /* æç¤ºç”¨æˆ·å®‰è£…çš„æ–‡å­— */
        .install-tip { font-size: 12px; color: #666; text-align: center; margin-bottom: 20px; border: 1px dashed #ccc; padding: 10px; border-radius: 10px; }
    </style>
</head>
<body>

    <h1>FOCUS.</h1>
    
    <div class="install-tip">
        ğŸ’¡ ç‚¹å‡» Chrome å³ä¸Šè§’â€œä¸‰ä¸ªç‚¹â€ -> â€œå®‰è£…åº”ç”¨â€æˆ–â€œæ·»åŠ åˆ°ä¸»å±å¹•â€ï¼Œä½“éªŒæ›´ä½³ã€‚
    </div>

    <div class="card">
        <label>è‡ªå¾‹ç›®æ ‡</label>
        <input type="text" id="gInput" placeholder="å†™ä¸‹ä½ çš„ç›®æ ‡...">
        <label>è®¡åˆ’å¤©æ•°</label>
        <input type="number" id="targetDays" placeholder="ä¾‹å¦‚ï¼š21">
        <label>æé†’æ—¶é—´</label>
        <input type="time" id="tInput" value="08:00">
        <button class="primary-btn" onclick="add()">å¼€å¯è®¡åˆ’</button>
    </div>

    <div id="list"></div>

    <script>
        let goals = JSON.parse(localStorage.getItem('my_discipline_final')) || [];

        function add() {
            const title = document.getElementById('gInput').value;
            const days = document.getElementById('targetDays').value;
            const time = document.getElementById('tInput').value;
            if(!title || !days) return alert("è¯·å¡«å†™å®Œæ•´");

            goals.push({ id: Date.now(), title, targetDays: days, currentDays: 0, time, doneToday: false });
            save();
            syncToSystem(time, title);
            document.getElementById('gInput').value = '';
            document.getElementById('targetDays').value = '';
        }

        // æ ¸å¿ƒåŒæ­¥å‡½æ•°ï¼šåˆ©ç”¨ç”¨æˆ·äº¤äº’è§¦å‘
        function syncToSystem(time, title) {
            const [h, m] = time.split(':');
            const intent = `intent:#Intent;action=android.intent.action.SET_ALARM;i:android.intent.extra.alarm.HOUR=${parseInt(h)};i:android.intent.extra.alarm.MINUTES=${parseInt(m)};s:android.intent.extra.alarm.MESSAGE=${encodeURIComponent(title)};b:android.intent.extra.alarm.SKIP_UI=false;end`;
            
            // å¼¹å‡ºç¡®è®¤æ¡†ã€‚åœ¨å°ç±³ç³»ç»Ÿé‡Œï¼Œç¡®è®¤æ¡†ä¹‹åçš„è·³è½¬å±äºâ€œé«˜æƒé‡ç”¨æˆ·è¡Œä¸ºâ€
            if (confirm("æ˜¯å¦ç°åœ¨åŒæ­¥åˆ°ç³»ç»Ÿé—¹é’Ÿï¼Ÿ\n(è‹¥æœªè·³è½¬ï¼Œè¯·ç¡®ä¿å·²ç‚¹å‡»â€œå®‰è£…åº”ç”¨â€å¹¶å…è®¸åå°å¼¹å‡º)")) {
                window.location.href = intent;
            }
        }

        function toggle(id) {
            goals = goals.map(g => {
                if(g.id === id) {
                    g.doneToday = !g.doneToday;
                    g.currentDays += g.doneToday ? 1 : -1;
                }
                return g;
            });
            save();
        }

        function del(id) {
            if(confirm("ç¡®å®šåˆ é™¤ï¼Ÿ")) {
                goals = goals.filter(g => g.id !== id);
                save();
            }
        }

        function save() {
            localStorage.setItem('my_discipline_final', JSON.stringify(goals));
            render();
        }

        function render() {
            document.getElementById('list').innerHTML = goals.map(g => `
                <div class="goal-item ${g.doneToday ? 'done' : ''}">
                    <div class="goal-header">
                        <div>
                            <div style="font-weight:bold; font-size:18px;">${g.title}</div>
                            <div style="font-size:12px; color:#666;">è¿›åº¦: ${g.currentDays}/${g.targetDays} å¤©</div>
                        </div>
                        <div class="check-box" onclick="toggle(${g.id})"></div>
                    </div>
                    <button class="sync-btn" onclick="syncToSystem('${g.time}', '${g.title}')">â° åŒæ­¥å“é“ƒ: ${g.time}</button>
                    <button class="delete-link" onclick="del(${g.id})">åˆ é™¤</button>
                </div>
            `).reverse().join('');
        }
        render();
    </script>
</body>
</html>
