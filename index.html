<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>极简自律</title>
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="application-name" content="极简自律">
    <meta name="description" content="一个简单的自律打卡应用">
    
    <link rel="manifest" href='data:application/manifest+json,{"name":"极简自律","short_name":"自律","description":"自律闹钟打卡","start_url":".","display":"standalone","background_color":"#ffffff","theme_color":"#000000","icons":[{"src":"https://cdn-icons-png.flaticon.com/512/3587/3587210.png","sizes":"512x512","type":"image/png"}]}'>

    <style>
        :root { --bg: #ffffff; --main: #000000; --gray: #f2f2f2; }
        body { background: var(--bg); color: var(--main); font-family: -apple-system, sans-serif; margin: 0; padding: env(safe-area-inset-top) 20px 20px 20px; }
        .card { background: var(--gray); border-radius: 28px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        h1 { font-size: 38px; font-weight: 900; margin-bottom: 30px; letter-spacing: -1.5px; }
        label { display: block; font-size: 13px; margin: 10px 0 8px 10px; font-weight: 600; opacity: 0.6; }
        input { width: 100%; border: 1px solid #ddd; background: #fff; padding: 18px; border-radius: 20px; margin-bottom: 15px; box-sizing: border-box; font-size: 16px; outline: none; }
        .primary-btn { width: 100%; background: var(--main); color: #fff; border: none; padding: 18px; border-radius: 22px; font-weight: bold; font-size: 18px; cursor: pointer; }
        .goal-item { border: 2.5px solid var(--main); border-radius: 26px; padding: 20px; margin-bottom: 18px; background: #fff; }
        .goal-header { display: flex; justify-content: space-between; align-items: center; }
        .goal-item.done { background: var(--gray); border-color: transparent; opacity: 0.5; }
        .check-box { width: 34px; height: 34px; border: 2.5px solid var(--main); border-radius: 12px; cursor: pointer; }
        .done .check-box { background: var(--main); position: relative; }
        .done .check-box::after { content: '✓'; color: #fff; position: absolute; left: 9px; top: 2px; font-size: 22px; }
        .sync-btn { background: #000; color: #fff; font-size: 12px; padding: 8px 16px; border-radius: 14px; border: none; margin-top: 15px; cursor: pointer; font-weight: 600; }
        .delete-link { font-size: 13px; color: #ff4d4d; background: none; border: none; margin-top: 20px; cursor: pointer; }
    </style>
</head>
<body>

    <h1>Focus.</h1>

    <div class="card">
        <label>目标名称</label>
        <input type="text" id="gInput" placeholder="写下你的目标...">
        <label>提醒时间</label>
        <input type="time" id="tInput" value="08:00">
        <button class="primary-btn" onclick="add()">开启 App 计划</button>
    </div>

    <div id="list"></div>

    <script>
        let goals = JSON.parse(localStorage.getItem('my_real_app_v1')) || [];

        function add() {
            const title = document.getElementById('gInput').value;
            const time = document.getElementById('tInput').value;
            if(!title) return alert("写个名字吧");
            goals.push({ id: Date.now(), title, time, doneToday: false, count: 0 });
            save();
            syncToSystem(time, title);
            document.getElementById('gInput').value = '';
        }

        function syncToSystem(time, title) {
            const [h, m] = time.split(':');
            const intent = `intent:#Intent;action=android.intent.action.SET_ALARM;i:android.intent.extra.alarm.HOUR=${parseInt(h)};i:android.intent.extra.alarm.MINUTES=${parseInt(m)};s:android.intent.extra.alarm.MESSAGE=${encodeURIComponent(title)};b:android.intent.extra.alarm.SKIP_UI=false;end`;
            
            if (confirm("正在尝试同步到系统闹钟，若未跳转请点确定。")) {
                window.location.href = intent;
            }
        }

        function toggle(id) {
            goals = goals.map(g => {
                if(g.id === id) {
                    g.doneToday = !g.doneToday;
                    g.count += g.doneToday ? 1 : -1;
                }
                return g;
            });
            save();
        }

        function del(id) {
            if(confirm("确定删除？")) { goals = goals.filter(g => g.id !== id); save(); }
        }

        function save() { localStorage.setItem('my_real_app_v1', JSON.stringify(goals)); render(); }
        function render() {
            document.getElementById('list').innerHTML = goals.map(g => `
                <div class="goal-item ${g.doneToday ? 'done' : ''}">
                    <div class="goal-header">
                        <div>
                            <div style="font-weight:900; font-size:20px;">${g.title}</div>
                            <div style="font-size:13px; color:#666;">坚持了 ${g.count} 天 • ${g.time}</div>
                        </div>
                        <div class="check-box" onclick="toggle(${g.id})"></div>
                    </div>
                    <button class="sync-btn" onclick="syncToSystem('${g.time}', '${g.title}')">⏰ 同步闹钟</button>
                    <button class="delete-link" onclick="del(${g.id})">删除</button>
                </div>
            `).reverse().join('');
        }
        render();
    </script>
</body>
</html>
